name: TitanBot Final Victory
on: [push, workflow_dispatch]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-java@v4
        with: { java-version: '17', distribution: 'temurin' }

      - name: ğŸ› ï¸ Repair & Inject Logic
        # Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ ÙŠØ±Ø¨Ø· Ù…Ù„Ù Ø§Ù„Ø¬Ø§ÙØ§ Ø§Ù„Ø¹Ù…Ù„Ø§Ù‚ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ø¨Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¢Ù„ÙŠØ§Ù‹
        run: |
          mkdir -p app/src/main/java/com/titan/bot app/src/main/res/layout app/src/main/res/values
          
          # Ù†Ù‚Ù„ Ù…Ù„Ù Ø§Ù„Ø¬Ø§ÙØ§ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù„Ù…ÙƒØ§Ù†Ù‡ Ø§Ù„ØµØ­ÙŠØ­ Ù„Ø¶Ù…Ø§Ù† Ù‚Ø±Ø§Ø¡ØªÙ‡
          cp *.java app/src/main/java/com/titan/bot/MainActivity.java || echo "Using existing java"
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© XML Ù„ØªØ¹Ù…Ù„ Ù…Ø¹findViewById ÙÙŠ ÙƒÙˆØ¯Ùƒ
          cat <<EOF > app/src/main/res/layout/activity_main.xml
          <LinearLayout xmlns:android="http://schemas.android.com/apk/res/android" android:layout_width="match_parent" android:layout_height="match_parent" android:orientation="vertical">
              <TextView android:id="@+id/dashboardView" android:layout_width="match_parent" android:layout_height="wrap_content" android:text="System Ready"/>
              <EditText android:id="@+id/linkInput" android:layout_width="match_parent" android:layout_height="wrap_content" android:hint="URL"/>
              <Button android:id="@+id/controlButton" android:layout_width="match_parent" android:layout_height="wrap_content" android:text="START"/>
              <WebView android:id="@+id/myBrowser" android:layout_width="match_parent" android:layout_height="match_parent"/>
          </LinearLayout>
          EOF

      - name: ğŸš€ Force Build APK
        run: |
          echo "include ':app'" > settings.gradle
          cat <<EOF > build.gradle
          buildscript { repositories { google(); mavenCentral() }; dependencies { classpath 'com.android.tools.build:gradle:7.4.2' } }
          allprojects { repositories { google(); mavenCentral() } }
          EOF
          cat <<EOF > app/build.gradle
          plugins { id 'com.android.application' }; android { namespace 'com.titan.bot'; compileSdk 33; defaultConfig { applicationId "com.titan.bot"; minSdk 21; targetSdk 33 } }
          dependencies { implementation 'androidx.appcompat:appcompat:1.6.1'; implementation 'com.google.android.material:material:1.9.0' }
          EOF
          cat <<EOF > app/src/main/AndroidManifest.xml
          <manifest xmlns:android="http://schemas.android.com/apk/res/android" package="com.titan.bot">
              <uses-permission android:name="android.permission.INTERNET" />
              <application android:label="TitanBot"><activity android:name=".MainActivity" android:exported="true"><intent-filter><action android:name="android.intent.action.MAIN"/><category android:name="android.intent.category.LAUNCHER"/></intent-filter></activity></application>
          </manifest>
          EOF
          gradle assembleDebug --no-daemon

      - name: ğŸ“¦ Deliver APK
        uses: actions/upload-artifact@v4
        with: { name: TitanBot-Final, path: app/build/outputs/apk/debug/*.apk }
        
