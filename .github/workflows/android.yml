name: TitanBot Auto-Repair & Build
on: [push, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Checkout Code
        uses: actions/checkout@v4

      - name: 2. Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: 3. Intelligent Bot Repair (Ø¨ÙˆØª Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø°ÙƒÙŠ)
        # Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ Ù‡Ùˆ Ø§Ù„Ø£Ø¯Ø§Ø© Ø§Ù„ØªÙŠ Ø·Ù„Ø¨ØªÙ‡Ø§: ØªØ¨Ø­Ø«ØŒ ØªØµÙ„Ø­ØŒ ÙˆØªÙ†Ø³Ù‚ Ø¢Ù„ÙŠØ§Ù‹
        run: |
          echo "ğŸ¤– Starting TitanBot Repair Tool..."
          
          # Ø£- ØªÙ†Ø¸ÙŠÙ Ø´Ø§Ù…Ù„: Ø­Ø°Ù Ø£ÙŠ Ù…Ù„ÙØ§Øª Ù‚Ø¯ÙŠÙ…Ø© Ø£Ùˆ Ù…ØªØ¹Ø§Ø±Ø¶Ø© ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ø®Ø§Ø·Ø¦Ø©
          rm -rf app build.gradle settings.gradle gradle.properties
          
          # Ø¨- Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„ØµØ­ÙŠØ­: Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„ØªÙŠ ÙŠØªÙˆÙ‚Ø¹Ù‡Ø§ Ø§Ù„Ù†Ø¸Ø§Ù… (Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØµÙˆØ±Ø© 1000008327)
          mkdir -p app/src/main/java/com/titan/bot
          mkdir -p app/src/main/res/layout
          mkdir -p app/src/main/res/values

          # Ø¬- Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† "ÙƒÙˆØ¯Ùƒ Ø§Ù„Ø¹Ù…Ù„Ø§Ù‚": Ø³Ø­Ø¨ Ø£ÙŠ Ù…Ù„Ù Ø¬Ø§ÙØ§ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ ÙˆÙˆØ¶Ø¹Ù‡ ÙÙŠ Ù…ÙƒØ§Ù†Ù‡ Ø§Ù„ØµØ­ÙŠØ­
          # Ù‡Ø°Ø§ ÙŠØªØ®Ù„Øµ Ù…Ù† Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ÙŠØ¯ÙˆÙŠ Ø¹Ù† Ø§Ù„Ù…Ù„ÙØ§Øª
          find . -maxdepth 2 -name "*.java" -exec cp {} app/src/main/java/com/titan/bot/MainActivity.java \;

          # Ø¯- ØªÙˆØ­ÙŠØ¯ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚: Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„ÙØ§Øª Ø§Ù„Ø±Ø¨Ø· (XML & Gradle) Ù„ØªØªØ·Ø§Ø¨Ù‚ ØªÙ…Ø§Ù…Ø§Ù‹ Ù…Ø¹ Ø§Ù„ÙƒÙˆØ¯
          echo "include ':app'" > settings.gradle
          echo "android.useAndroidX=true" > gradle.properties
          echo "android.enableJetifier=true" >> gradle.properties
          
          cat <<EOF > build.gradle
          buildscript { repositories { google(); mavenCentral() }; dependencies { classpath 'com.android.tools.build:gradle:7.4.2' } }
          allprojects { repositories { google(); mavenCentral() } }
          EOF

          cat <<EOF > app/build.gradle
          plugins { id 'com.android.application' }
          android { 
              namespace 'com.titan.bot'
              compileSdk 33
              defaultConfig { applicationId "com.titan.bot"; minSdk 21; targetSdk 33 }
          }
          dependencies { 
              implementation 'androidx.appcompat:appcompat:1.6.1'
              implementation 'com.google.android.material:material:1.9.0'
          }
          EOF

          # Ù‡Ù€- Ø§Ù„Ù…Ø§Ù†ÙŠÙØ³Øª: Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ù„Ø¨ÙˆØª Ù„ÙŠØ¹Ù…Ù„ (Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª)
          cat <<EOF > app/src/main/AndroidManifest.xml
          <manifest xmlns:android="http://schemas.android.com/apk/res/android" package="com.titan.bot">
              <uses-permission android:name="android.permission.INTERNET" />
              <application android:label="TitanBot" android:theme="@style/Theme.AppCompat.Light">
                  <activity android:name=".MainActivity" android:exported="true">
                      <intent-filter>
                          <action android:name="android.intent.action.MAIN"/><category android:name="android.intent.category.LAUNCHER"/>
                      </intent-filter>
                  </activity>
              </application>
          </manifest>
          EOF

      - name: 4. Final Construction (Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ)
        # Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø­Ø±Ùƒ Ø¨Ù†Ø§Ø¡ Ù…Ø³ØªÙ‚Ø± ÙŠØªØ¬Ø§ÙˆØ² ØªØ¹Ø§Ø±Ø¶Ø§Øª Gradle 9 (Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØµÙˆØ±Ø© 1000008333)
        run: |
          gradle wrapper --gradle-version 7.5.1
          ./gradlew assembleDebug --no-daemon

      - name: 5. Secure Artifact Delivery
        uses: actions/upload-artifact@v4
        with:
          name: TitanBot-Final-Package
          path: app/build/outputs/apk/debug/*.apk
