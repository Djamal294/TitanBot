name: TitanBot Simple Build
on: [push, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Checkout
        uses: actions/checkout@v4

      - name: 2. JDK Setup
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: 3. Clean Project Structure
        # مسح الملفات القديمة لضمان عدم التعارض
        run: |
          rm -rf app build.gradle settings.gradle gradle.properties
          mkdir -p app/src/main/java/com/titan/bot
          mkdir -p app/src/main/res/layout
          mkdir -p app/src/main/res/values

      - name: 4. Inject Files
        # وضع ملف الجافا والواجهة في مكانهما الصحيح
        run: |
          # ملف الواجهة (الجسد)
          cat <<EOF > app/src/main/res/layout/activity_main.xml
          <LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
              android:layout_width="match_parent" android:layout_height="match_parent" android:orientation="vertical">
              <TextView android:id="@+id/dashboardView" android:layout_width="match_parent" android:layout_height="wrap_content" android:text="System Ready"/>
              <EditText android:id="@+id/linkInput" android:layout_width="match_parent" android:layout_height="wrap_content" android:hint="URL"/>
              <Button android:id="@+id/controlButton" android:layout_width="match_parent" android:layout_height="wrap_content" android:text="START"/>
              <WebView android:id="@+id/myBrowser" android:layout_width="match_parent" android:layout_height="match_parent"/>
          </LinearLayout>
          EOF

          # ملف الجافا (استخدام ملفك الأصلي)
          cp *.java app/src/main/java/com/titan/bot/MainActivity.java || echo "No Java file found in root"

      - name: 5. Execute Build
        # استخدام إعدادات البناء العادية لتخطي أخطاء Gradle 9
        run: |
          echo "include ':app'" > settings.gradle
          echo "android.useAndroidX=true" > gradle.properties
          
          cat <<EOF > build.gradle
          buildscript { repositories { google(); mavenCentral() }; dependencies { classpath 'com.android.tools.build:gradle:7.4.2' } }
          allprojects { repositories { google(); mavenCentral() } }
          EOF

          cat <<EOF > app/build.gradle
          plugins { id 'com.android.application' }
          android { namespace 'com.titan.bot'; compileSdk 33; defaultConfig { applicationId "com.titan.bot"; minSdk 21; targetSdk 33 } }
          dependencies { implementation 'androidx.appcompat:appcompat:1.6.1'; implementation 'com.google.android.material:material:1.9.0' }
          EOF

          cat <<EOF > app/src/main/AndroidManifest.xml
          <manifest xmlns:android="http://schemas.android.com/apk/res/android" package="com.titan.bot">
              <uses-permission android:name="android.permission.INTERNET" />
              <application android:label="TitanBot"><activity android:name=".MainActivity" android:exported="true"><intent-filter><action android:name="android.intent.action.MAIN"/><category android:name="android.intent.category.LAUNCHER"/></intent-filter></activity></application>
          </manifest>
          EOF
          gradle assembleDebug --no-daemon

      - name: 6. Upload Result
        uses: actions/upload-artifact@v4
        with:
          name: TitanBot-Standard-APK
          path: app/build/outputs/apk/debug/*.apk
          
